#!/bin/bash
clear

echo -e "\033[1;30m------------------------------------------------------------------------------------\033[0m"
echo -e "\033[1;37mUsuario           Data E.          download/upload               Conectado desde  \033[0m"
echo -e "\033[1;30m------------------------------------------------------------------------------------\033[0m"
for users in `cat /etc/datexp | cut -d ":" -f 1`
do
tempo=$(grep -w $users /etc/openvpn/openvpn-status.log | grep -vi 10.8 | cut -d "," -f 5)
downloadupload=$(grep -w $users /etc/openvpn/openvpn-status.log | grep -vi 10.8 | cut -d "," -f 3,4)
data=$(grep -w $users /etc/datexp | cut -d ":" -f 2)

if [[ $data = "" ]] 2> /dev/null
then
date="Nunca"
fi
usertotal=$(cat /etc/datexp | cut -d ":" -f 1 | wc -l)

#calculo=$(ps x | grep "sshd:" |grep "priv" |grep -vi root |wc -l)

detalhesdata=$(printf '%-18s' "$data")
detalhesdownload=$(printf '%-10s' "$downloadupload")
detalhes=$(printf ' %-14s' "$users")


if [[ $tempo = "" ]]; then
echo -e "\033[1;33m$detalhes $detalhesdata  $downloadupload                    \033[1;31moffline\033[0m"
else
echo -e "\033[1;33m$detalhes $detalhesdata  $downloadupload           $tempo\033[0m"
fi
echo -e "\033[1;30m------------------------------------------------------------------------------------\033[0m"
done
echo -e "\033[1;33mTotal: $usertotal     Online: \033[1;32m$calculo\033[0m"
